# Release Notes – v1.6.3

## Highlights

- **Legacy release archive surfaced:** Every GitHub release up through v1.6.2 now carries an `ARCHIVED` notice, links back to `archive/README.md`, and consolidates its historical scripts/binaries into a single downloadable bundle for auditors.
- **Obsolete package retirement:** Added guidance (and CLI snippets) for deleting or privatizing the three unused GitHub Packages so downstream deployments stop resolving stale artifacts.
- **Documentation refresh:** README, CHANGELOG, docs/DOCUMENTATION_INDEX.md, and the operations guides now reference v1.6.3 as the active release and explain how to promote the archive when tagging future versions.
- **Release automation hooks:** This file serves as the canonical release-notes source so `gh release create v1.6.3 --notes-file docs/releases/v1.6.3.md` publishes the exact same content you read in-repo.

## Operator Notice – Legacy Assets

Releases at or below v1.6.2 are no longer supported. Their setup/stop wrappers, emergency helper scripts, and other deprecated assets live exclusively under [`archive/`](../../archive/README.md). Do **not** execute those files in production; they exist only for historical reference. All supported workflows continue to use `RUN.ps1`, `scripts/dev/run-native.ps1`, and `SMS.ps1`.

## Upgrade Notes

1. **Archive the old releases/packages:** Before cutting this tag, run `pwsh -NoProfile -File scripts/ops/archive-releases.ps1 -DryRun` to preview the archival banner for every legacy release (you can point `-ReleasesJsonPath` at `scripts/ops/samples/releases.sample.json` when testing offline), then rerun without `-DryRun` to apply the changes. Afterwards, delete/privatize the three unused GitHub Packages.
2. **Publish directly from the repo:** Run `gh release create v1.6.3 --title "v1.6.3 – Release archive + cleanup" --notes-file docs/releases/v1.6.3.md` (attach any current artifacts you ship with RUN/SMART_SETUP).
3. **Point operators to the archive:** Reference the archive release in deployment runbooks and let automation teams know that only `v1.6.3` (and later) should be pulled moving forward.
4. **Re-run the test suites:** Backend `pytest -q` and frontend `npm run test -- --runInBand` should both be green before tagging.

## Automating the Archive Sweep

Prefer to run the archival helper from GitHub Actions so auditors can review the immutable job log. From the repository's **Actions** tab trigger **Archive legacy releases**, keep the default `threshold_tag` of `v1.6.2`, and execute the workflow once with `dry_run=true` to capture the pending changes table. When the summary looks correct, re-run the workflow with `dry_run=false`; it will invoke `scripts/ops/archive-releases.ps1` on the checked-out `main` branch and push the warning banner plus prerelease toggle to every matching release.

## Removing Legacy GitHub Packages

All three historical GHCR images (`sms-backend`, `sms-frontend`, `sms-fullstack`) must be deleted or privatized so automation does not pull them accidentally. Run `pwsh -NoProfile -File scripts/ops/remove-legacy-packages.ps1 -DryRun` to see the pending actions (optional: `-PackageDataPath scripts/ops/samples/package-versions.sample.json` for offline simulation), then rerun without `-DryRun` (or with `-Privatize`) once you're ready. Under the hood the script executes the same GitHub CLI calls outlined below, so you can also run the commands manually if you prefer:

```powershell
# List every version ID under a package
gh api `
  -H "Accept: application/vnd.github+json" `
  "/orgs/bs1gr/packages/container/sms-backend/versions" `
  --jq '.[].id'

# Delete all versions for a package (repeat for sms-frontend / sms-fullstack)
$package = "sms-backend"
$versionIds = gh api `
  -H "Accept: application/vnd.github+json" `
  "/orgs/bs1gr/packages/container/$package/versions" `
  --jq '.[].id'
foreach ($id in $versionIds) {
  gh api --method DELETE `
    -H "Accept: application/vnd.github+json" `
    "/orgs/bs1gr/packages/container/$package/versions/$id"
}
```

If you prefer to retain the artifacts privately (instead of deleting them), call `gh api --method PATCH` with `{"visibility":"private"}` against `/orgs/bs1gr/packages/container/<package>` rather than running the DELETE loop above.

## Container Images & Build Args

Every Dockerfile in this release expects three metadata build args so the resulting image carries traceable provenance:

- `VERSION = 1.6.3`
- `BUILD_DATE = 2025-11-15T21:34:08+02:00`
- `VCS_REF = 052941be2297739e6b34a5dcd506876313133853`

When rebuilding the GHCR images, pass the args explicitly (example shows the frontend build, repeat for backend/fullstack as needed):

```powershell
$version = "1.6.3"
$buildDate = "2025-11-15T21:34:08+02:00"
$vcsRef = "052941be2297739e6b34a5dcd506876313133853"

docker build -f docker/Dockerfile.frontend `
  --build-arg VERSION=$version `
  --build-arg BUILD_DATE=$buildDate `
  --build-arg VCS_REF=$vcsRef `
  -t ghcr.io/bs1gr/sms-frontend:v$version .
```

Tag the resulting image as both `v1.6.3` and `latest` before pushing to GHCR so automated deployments keep resolving the same digest.

### GHCR digests for v1.6.3

| Image | Tags | Digest |
| --- | --- | --- |
| `ghcr.io/bs1gr/sms-fullstack` | `v1.6.3`, `latest` | `sha256:9b6c8243de76eae7fe6f641823f30d6b9ca54057c1a08347e7fefff45f7976a0` |
| `ghcr.io/bs1gr/sms-backend` | `v1.6.3`, `latest` | `sha256:e5e480f392dec8e9bc36c42e2724e680a9516feeee799549424b8f8b4ad7342f` |
| `ghcr.io/bs1gr/sms-frontend` | `v1.6.3`, `latest` | `sha256:64273d8fb8e5abb333f0d9d74f556b5f65a5e93eafba9628c776accade1b2019` |

All three repos currently point both their `v1.6.3` and `latest` tags at the digests listed above, so operators can pin to either tag without triggering a rebuild.

## Cleanroom Validation (Native Mode)

To guarantee the repository ships in a pristine, reproducible state, `SUPER_CLEAN_AND_DEPLOY.ps1 -SetupMode Native -StartServices` was executed on 2025-11-15. Key outcomes:

- ✅ Stopped 8 lingering dev processes (esbuild, npm/vite, uvicorn) before wiping artifacts.
- ✅ Reclaimed ~408 MB by deleting virtualenvs, caches, `frontend/node_modules`, log files, and temp folders.
- ✅ Rebuilt the backend virtualenv with Python 3.13, upgraded `pip`, installed `requirements.txt` + `requirements-dev.txt`, and re-ran Alembic migrations.
- ✅ Reinstalled frontend dependencies with `npm ci` and validated the bundle via `npm run build`.
- ✅ Relaunched native services: backend dev server on `http://127.0.0.1:8000` (healthy) and frontend dev server on `http://localhost:5173` (responding).
- ⚠️ Alembic surfaced "Multiple head revisions"—no blocking impact on this run, but operators should reconcile divergent heads (`cd backend; .venv\Scripts\python -m alembic heads`) before tagging future migrations.

These steps ensure anyone cloning v1.6.3 can replicate a clean environment without inheriting stale caches or zombie processes.
