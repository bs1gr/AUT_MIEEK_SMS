# GitHub PR Template for Phase 2 (RBAC & CI/CD)

**File Location**: `.github/pull_request_template/phase2_rbac.md`

This template is automatically used for PRs targeting Phase 2 (RBAC) work.

---

```markdown
## ğŸ“‹ PR Title

**Format**: `[Phase 2] [Week X] Component: Brief description`

**Examples**:
- `[Phase 2] [Week 1] RBAC: Add permission model and migration`
- `[Phase 2] [Week 2] Students Router: Apply permission decorators`
- `[Phase 2] [Week 3] Admin API: Add permission management endpoints`

---

## ğŸ“ Description

### What does this PR do?
(2-3 sentences explaining the feature/fix)

### Why is this needed?
(Link to PHASE2_CONSOLIDATED_PLAN.md task)

### Week/Task Reference
- **Week**: [1-6]
- **Task**: [Task 1.1, Task 2.5, etc.]
- **GitHub Issue**: Closes #XXX

---

## ğŸ” Testing

### Unit Tests
- [ ] Added tests for new functionality
- [ ] Coverage target met (95%+ for critical code)
- [ ] All tests passing locally
- [ ] Tests documented with examples

**Run tests locally**:
```bash
cd backend
pytest tests/test_rbac.py -v --cov=backend.rbac --cov-report=term
```

### Integration Tests
- [ ] Tested with existing code
- [ ] No regressions in other features
- [ ] Tested permission inheritance
- [ ] Tested edge cases (multi-role, cascading)

### Manual Testing
- [ ] Tested in staging environment
- [ ] Verified with different user roles
- [ ] Tested on both Chrome and Firefox

---

## ğŸ” Security Checklist (REQUIRED for all RBAC PRs)

- [ ] Permission checks implemented
- [ ] Decorator defaults to DENY (safe fail)
- [ ] No permission bypass via parameter manipulation
- [ ] Error messages don't leak permission structure
- [ ] Audit logging added (if applicable)
- [ ] Security review completed (2-person review required)

**Security Review**: @tech-lead @security-dev (required)

---

## ğŸ“Š Performance Impact

### Database Queries
- [ ] No N+1 query issues
- [ ] Used eager loading (selectinload)
- [ ] Query count verified with profiling
- [ ] Response time targets met

**Performance Testing**:
```bash
# Load test
cd load-testing
locust -f locustfile.py --headless -u 100 -r 10 --run-time 5m
```

**Expected Results**:
- Student list: <200ms p95
- Grade list: <200ms p95
- Permission check: <50ms per request

### Resource Usage
- [ ] No memory leaks
- [ ] CPU usage within baseline
- [ ] Database connections stable

---

## ğŸ“š Documentation

### Code Documentation
- [ ] Docstrings added to all new functions
- [ ] Type hints on all function parameters
- [ ] Complex logic explained with comments
- [ ] Examples provided for public APIs

### User Documentation
- [ ] README.md updated (if applicable)
- [ ] Admin guide updated (for permission-related changes)
- [ ] API docs updated in `backend/CONTROL_API.md`

### Translation
- [ ] Error messages translated to EN/EL
- [ ] UI strings translated (if frontend changes)
- [ ] No hardcoded strings
- [ ] Used i18n translation keys

---

## ğŸ”„ Migration & Data

### Database Migrations
- [ ] Alembic migration created (if schema change)
- [ ] Migration tested on fresh DB
- [ ] Migration tested on existing DB with data
- [ ] Rollback tested and verified
- [ ] No data loss scenarios
- [ ] Performance acceptable (<5 min for large DB)

**Migration Command**:
```bash
cd backend
alembic revision --autogenerate -m "description"
alembic upgrade head
alembic downgrade -1  # Test rollback
```

### Data Validation
- [ ] Data integrity verified after changes
- [ ] No orphaned records
- [ ] Constraints enforced
- [ ] Indexes created where needed

---

## ğŸ“¦ Files Changed

(Auto-generated by GitHub)

### Changed File Categories
- Backend: routers/models/services/schemas
- Frontend: components/pages/api/locales
- Tests: backend/tests or frontend/__tests__
- Migrations: backend/migrations

---

## âœ… Deployment Readiness

### Pre-Merge Checks
- [ ] All tests passing in CI/CD
- [ ] Coverage reports within targets
- [ ] Code review approved (2+ reviewers for critical)
- [ ] No merge conflicts
- [ ] Branch is up-to-date with main

### Staging Validation
- [ ] Tested in staging environment
- [ ] No new errors in logs
- [ ] Performance baseline met
- [ ] Smoke tests all passing

### Release Notes
- [ ] Feature documented for release notes
- [ ] Breaking changes documented (if any)
- [ ] Migration guide updated (if needed)
- [ ] Known issues documented (if any)

---

## ğŸ¯ Definition of Done

This PR is complete when:
1. âœ… Code written and tested
2. âœ… Tests added and passing (95%+ coverage)
3. âœ… Security review passed (2+ reviewers)
4. âœ… Documentation updated
5. âœ… Performance verified
6. âœ… Staging validation passed
7. âœ… Code review approved

---

## ğŸ“‹ Reviewers

**Required Reviewers**:
- [ ] Tech Lead (@tech-lead) - Final approval
- [ ] One Backend Developer (@dev1 or @dev2) - Code review
- [ ] Security Reviewer (@security-dev) - For RBAC changes

**Additional Reviewers**:
- [ ] QA (@qa-lead) - For E2E/integration tests
- [ ] DevOps (@devops) - For deployment changes

---

## ğŸ’¬ Related Issues

Closes: #XXX (Link to task in UNIFIED_WORK_PLAN)

Related: #YYY, #ZZZ (Other related PRs/issues)

---

## ğŸ¬ Merge Instructions

**When ready to merge**:

1. Ensure all checks pass (green checkmarks)
2. Get approval from at least 3 reviewers (Tech Lead + 2 others)
3. Merge to `main` using "Squash and merge" option
4. Delete feature branch after merge
5. Update UNIFIED_WORK_PLAN.md checklist

**Commit Message Format**:
```
[Phase 2] [Week X] Feature: Brief description

- Task: Task X.X from PHASE2_CONSOLIDATED_PLAN
- Tests: Added X test cases
- Coverage: Y% (target 95%)
- Performance: Z ms (target <200ms)

Closes #XXX
```

---

## ğŸ”” Notes

- Phase 2 timeline: Jan 27 - Mar 7, 2026
- Plan reference: [PHASE2_CONSOLIDATED_PLAN.md](../../docs/plans/PHASE2_CONSOLIDATED_PLAN.md)
- Detailed work plan: [UNIFIED_WORK_PLAN.md](../../docs/plans/UNIFIED_WORK_PLAN.md)
- Risk register: [PHASE2_RISK_REGISTER.md](../../docs/deployment/PHASE2_RISK_REGISTER.md)

---

**Questions?** Check the Phase 2 plan or ask in #phase2-planning Slack channel.
```

---

## ğŸ“ Alternative: Feature Branch PR Template

For non-RBAC Phase 2 features, use this simpler template:

```markdown
## ğŸ¯ Feature/Fix

(Brief description)

## âœ… Checklist

- [ ] Tests added
- [ ] Tests passing
- [ ] Code reviewed
- [ ] Documentation updated
- [ ] No breaking changes
- [ ] Performance verified

## ğŸ“‹ Related

Closes #XXX
```

---

## ğŸ› ï¸ How to Use This Template

### Installation

1. Create `.github/pull_request_template/` directory (if not exists)
2. Save this file as `phase2_rbac.md`
3. For other Phase 2 work, save as `phase2_feature.md`

### Auto-Selection

**GitHub can't auto-select templates**, so:
1. When creating PR, click "Select template" dropdown
2. Choose `phase2_rbac` or `phase2_feature`
3. Or manually copy-paste the relevant section

### Customization Per Task

Teams can customize based on risk level:
- **Critical (R2, R8, R9)**: Use full template with all sections
- **High (R3, R5)**: Use standard template
- **Medium (R1, R4, R7)**: Use simplified template

---

## ğŸ“Š PR Review Metrics

**Target Metrics for Phase 2**:

| Metric | Target | Measurement |
|--------|--------|-------------|
| Code Review Turnaround | <24h | Time from PR open to first review |
| PR Size | <500 lines | Lines changed per PR |
| Test Coverage | â‰¥95% | Coverage reported in CI |
| Build Time | <10m | Total CI/CD time for merge |
| Approval Time | <2h | Time from approval to merge |

---

**PR Template Created**: January 7, 2026
**Status**: âœ… Ready for Phase 2
**Applicable**: Week 1-6, all RBAC and supporting work
